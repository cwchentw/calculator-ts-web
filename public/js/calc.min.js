var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])};return function(n,t){function r(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();define("token",["require","exports"],function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});!function(e){e[e.EOF=0]="EOF",e[e.Integer=1]="Integer",e[e.Float=2]="Float",e[e.Add=3]="Add",e[e.Sub=4]="Sub",e[e.Mul=5]="Mul",e[e.Div=6]="Div",e[e.Mod=7]="Mod",e[e.Pow=8]="Pow",e[e.LeftParen=9]="LeftParen",e[e.RightParen=10]="RightParen"}(n.TokenType||(n.TokenType={}));var t=function(){function e(e,n){var t=this;this.token=function(){return t.t},this.value=function(){return t.str},this.t=e,this.str=n}return e}();n.Token=t}),define("lexer",["require","exports","token"],function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e){var n=this;this.next=function(){return n.index+=1,n.index>=n.tokens.length?null:n.tokens[n.index]},this.peek=function(){return n.index+1>=n.tokens.length?null:n.tokens[n.index+1]},this.run=function(){for(var e=n.updateState;null!=e;)e=e()},this.updateState=function(){if(n.current>=n.strArray.length)return n.tokens.push(new t.Token(t.TokenType.EOF,"EOF")),null;var e=n.peekString();if("("===e)return n.lexKeyword(1,t.TokenType.LeftParen);if(")"===e)return n.lexKeyword(1,t.TokenType.RightParen);if("+"===e)return n.lexKeyword(1,t.TokenType.Add);if("-"===e)return n.lexKeyword(1,t.TokenType.Sub);if("*"===e)return n.lexTimes();if("/"===e)return n.lexKeyword(1,t.TokenType.Div);if("%"===e)return n.lexKeyword(1,t.TokenType.Mod);if(n.isDigit(e)||n.isDot(e))return n.lexNumber();if(n.isSpace(e))return n.offset+=1,n.current+=1,n.update(),n.updateState;throw new Error("Unknown string: "+e)},this.lexNumber=function(){var e=n.peekString();if("."===e)throw new Error("Number with leading dot.");for(;;){if(!n.isDigit(e)){if(n.isDot(e))return n.offset+=1,n.current+=1,n.lexFloat();break}if(n.offset+=1,n.current+=1,n.isOutOfBound())break;e=n.peekString()}return n.appendToken(t.TokenType.Integer),n.update(),n.updateState},this.lexFloat=function(){for(var e=".",r=!1;;){if(n.isDigit(e))n.offset+=1,n.current+=1;else{if(!n.isDot(e))break;if(r)throw new Error("Duplicated dot in number");n.offset+=1,n.current+=1,r=!0}if(n.isOutOfBound())break;e=n.peekString()}return n.appendToken(t.TokenType.Float),n.update(),n.updateState},this.lexTimes=function(){return n.pos+2<=n.strArray.length&&(n.current+=1,"*"===n.peekString())?n.lexKeyword(2,t.TokenType.Pow):n.lexKeyword(1,t.TokenType.Mul)},this.lexKeyword=function(e,t){return n.offset+=e,n.appendToken(t),n.update(),n.updateState},this.appendToken=function(e){var r=n.strArray.slice(n.pos,n.pos+n.offset).join("");n.tokens.push(new t.Token(e,r))},this.peekString=function(){return n.strArray[n.current]},this.isDigit=function(e){return"0"===e||"1"===e||"2"===e||"3"===e||"4"===e||"5"===e||"6"===e||"7"===e||"8"===e||"9"===e},this.isDot=function(e){return"."===e},this.isSpace=function(e){return" "===e||"\t"===e},this.isOutOfBound=function(){return n.current>n.strArray.length},this.update=function(){n.pos+=n.offset,n.offset=0,n.current=n.pos},this.pos=0,this.current=0,this.offset=0,this.index=-1,this.strArray=e.split(""),this.tokens=[],this.run()}return e}();n.Lexer=r}),define("ast",["require","exports"],function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=function(){function e(){var e=this;this.token=function(){return e.t},this.toString=function(){var n="";if(null===e.t)return n;if(0===e.children.length)return e.t.value();n+="(",n+=e.t.value();for(var t=0;t<e.children.length;t++)null!=e.children[t]&&(n+=" ",n+=e.children[t].toString());return n+=")"}}return e}();n.AST=t;var r=function(e){function n(n){var t=e.call(this)||this;return t.t=n,t.children=[],t}return __extends(n,e),n}(t);n.FactorAST=r;var o=function(e){function n(n,t){var r=e.call(this)||this;return r.getChild=function(){return r.children[0]},r.t=n,r.children=[],r.children.push(t),r}return __extends(n,e),n}(t);n.UniOpAST=o;var i=function(e){function n(n,t,r){var o=e.call(this)||this;return o.getLeftChild=function(){return o.children[0]},o.getRightChild=function(){return o.children[1]},o.t=n,o.children=[],o.children.push(t),o.children.push(r),o}return __extends(n,e),n}(t);n.BiOpAST=i}),define("parser",["require","exports","ast","token"],function(e,n,t,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e){var n=this;this.next=function(){return n.index+=1,n.index>n.stmt.length-1?null:n.stmt[n.index]},this.run=function(){for(n.currentToken=n.lexer.next();null!==n.currentToken;){var e=n.parseExpr();if(null===e)break;n.stmt.push(e),n.currentToken.token()===r.TokenType.EOF&&n.eat(r.TokenType.EOF)}},this.parseExpr=function(){var e=n.parseTerm();if(null===e)return null;for(;n.currentToken.token()===r.TokenType.Add||n.currentToken.token()===r.TokenType.Sub;){var o=n.currentToken;o.token()===r.TokenType.Add&&n.eat(r.TokenType.Add),o.token()===r.TokenType.Sub&&n.eat(r.TokenType.Sub);var i=n.parseTerm();if(null===i)throw new Error("Uneven "+o.value()+" expression");e=new t.BiOpAST(o,e,i)}return e},this.parseTerm=function(){var e=n.parseValue();if(null===e)return null;for(;n.currentToken.token()===r.TokenType.Mul||n.currentToken.token()===r.TokenType.Div||n.currentToken.token()===r.TokenType.Mod;){var o=n.currentToken;o.token()===r.TokenType.Mul&&n.eat(r.TokenType.Mul),o.token()===r.TokenType.Div&&n.eat(r.TokenType.Div),o.token()===r.TokenType.Mod&&n.eat(r.TokenType.Mod);var i=n.parseValue();if(null===i)throw new Error("Uneven "+o.value()+" term");e=new t.BiOpAST(o,e,i)}return e},this.parseValue=function(){var e=n.parseFactor();if(null===e)return null;for(;n.currentToken.token()===r.TokenType.Pow;){var o=n.currentToken;o.token()===r.TokenType.Pow&&n.eat(r.TokenType.Pow);var i=n.parseFactor();if(null===i)throw new Error("Uneven "+o.value()+" value");e=new t.BiOpAST(o,e,i)}return e},this.parseFactor=function(){var e=n.currentToken;if(e.token()===r.TokenType.Integer)return n.eat(r.TokenType.Integer),new t.FactorAST(e);if(e.token()===r.TokenType.Float)return n.eat(r.TokenType.Float),new t.FactorAST(e);if(e.token()===r.TokenType.Add)return n.eat(r.TokenType.Add),new t.UniOpAST(e,n.parseFactor());if(e.token()===r.TokenType.Sub)return n.eat(r.TokenType.Sub),new t.UniOpAST(e,n.parseFactor());if(e.token()===r.TokenType.LeftParen){n.eat(r.TokenType.LeftParen);var o=n.parseExpr();return n.eat(r.TokenType.RightParen),o}if(e.token()===r.TokenType.EOF)return n.eat(r.TokenType.EOF),null;if(null===e)return null;throw new Error("Unknown token: "+e.value())},this.eat=function(e){if(e!==n.currentToken.token())throw new Error("Wrong token: --\x3e"+n.currentToken.value()+"<--");n.currentToken=n.lexer.next()},this.lexer=e,this.stmt=[],this.index=-1,this.run()}return e}();n.Parser=o}),define("interpreter",["require","exports","ast","lexer","parser","token"],function(e,n,t,r,o,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e){var n=this;this.run=function(){return n.interpreter.run()},this.interpreter=new a(new o.Parser(new r.Lexer(e)))}return e}();n.Evaluator=u;var a=function(){function e(e){var n=this;this.run=function(){var e=n.parser.next();return null===e?null:n.eval(e)},this.eval=function(e){if(e instanceof t.BiOpAST){var r=e.token(),o=n.eval(e.getLeftChild()),u=n.eval(e.getRightChild());if(r.token()===i.TokenType.Add)return o+u;if(r.token()===i.TokenType.Sub)return o-u;if(r.token()===i.TokenType.Mul)return o*u;if(r.token()===i.TokenType.Div)return o/u;if(r.token()===i.TokenType.Mod)return o%u;if(r.token()===i.TokenType.Pow)return Math.pow(o,u);throw new Error("Unable to eval due to unknown bi-op")}if(e instanceof t.UniOpAST){var r=e.token(),a=n.eval(e.getChild());if(r.token()===i.TokenType.Add)return a;if(r.token()===i.TokenType.Sub)return-a;throw new Error("Unable to eval due to unknown uni-op")}if(e instanceof t.FactorAST){var r=e.token();if(r.token()===i.TokenType.Integer)return parseInt(r.value(),10);if(r.token()===i.TokenType.Float)return parseFloat(r.value());throw new Error("Unable to eval due to unknown factor")}throw new Error("Unable to eval due to unknown AST")},this.parser=e}return e}();n.Interpreter=a});